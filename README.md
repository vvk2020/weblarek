# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/main.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```sh
npm install
npm run dev
```

или

```sh
yarn
yarn dev
```

## Сборка

```sh
npm run build
```

или

```sh
yarn build
```

# Интернет-магазин «Web-Larёk»

«Web-Larёk» — это интернет-магазин с товарами для веб-разработчиков, где пользователи могут просматривать товары, добавлять их в корзину и оформлять заказы. Сайт предоставляет удобный интерфейс с модальными окнами для просмотра деталей товаров, управления корзиной и выбора способа оплаты, обеспечивая полный цикл покупки с отправкой заказов на сервер.

## Архитектура приложения

Код приложения разделен на слои согласно парадигме `MVP` (`Model-View-Presenter`), которая обеспечивает четкое разделение ответственности между классами слоев `Model` и `View`. Каждый слой несет свой смысл и ответственность:

`Model` - слой данных, отвечает за хранение и изменение данных.  
`View` - слой представления, отвечает за отображение данных на странице.  
`Presenter` - презентер содержит основную логику приложения и отвечает за связь представления и данных.

Взаимодействие между классами обеспечивается использованием событийно-ориентированного подхода. Модели и Представления генерируют события при изменении данных или взаимодействии пользователя с приложением, а Презентер обрабатывает эти события используя методы как Моделей, так и Представлений.

### Базовый код

#### Класс Component

Является базовым классом для всех компонентов интерфейса.
Класс является дженериком и принимает в переменной `T` тип данных, которые могут быть переданы в метод `render` для отображения.

Конструктор:  
`constructor(container: HTMLElement)` - принимает ссылку на DOM элемент за отображение, которого он отвечает.

Поля класса:  
`container: HTMLElement` - поле для хранения корневого DOM элемента компонента.

Методы класса:  
`render(data?: Partial<T>): HTMLElement` - Главный метод класса. Он принимает данные, которые необходимо отобразить в интерфейсе, записывает эти данные в поля класса и возвращает ссылку на DOM-элемент. Предполагается, что в классах, которые будут наследоваться от `Component` будут реализованы сеттеры для полей с данными, которые будут вызываться в момент вызова `render` и записывать данные в необходимые DOM элементы.  
`setImage(element: HTMLImageElement, src: string, alt?: string): void` - утилитарный метод для модификации DOM-элементов `<img>`

#### Класс Api

Содержит в себе базовую логику отправки запросов.

Конструктор:  
`constructor(baseUrl: string, options: RequestInit = {})` - В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.

Поля класса:  
`baseUrl: string` - базовый адрес сервера  
`options: RequestInit` - объект с заголовками, которые будут использованы для запросов.

Методы:  
`get(uri: string): Promise<object>` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер  
`post(uri: string, data: object, method: ApiPostMethods = 'POST'): Promise<object>` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.  
`handleResponse(response: Response): Promise<object>` - защищенный метод проверяющий ответ сервера на корректность и возвращающий объект с данными полученный от сервера или отклоненный промис, в случае некорректных данных.

#### Класс EventEmitter

Брокер событий реализует паттерн "Наблюдатель", позволяющий отправлять события и подписываться на события, происходящие в системе. Класс используется для связи слоя данных и представления.

Конструктор класса не принимает параметров.

Поля класса:  
`_events: Map<string | RegExp, Set<Function>>)` - хранит коллекцию подписок на события. Ключи коллекции - названия событий или регулярное выражение, значения - коллекция функций обработчиков, которые будут вызваны при срабатывании события.

Методы класса:  
`on<T extends object>(event: EventName, callback: (data: T) => void): void` - подписка на событие, принимает название события и функцию обработчик.  
`emit<T extends object>(event: string, data?: T): void` - инициализация события. При вызове события в метод передается название события и объект с данными, который будет использован как аргумент для вызова обработчика.  
`trigger<T extends object>(event: string, context?: Partial<T>): (data: T) => void` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие с передачей в него данных из второго параметра.

### Данные

#### `ApiPostMethods` - тип медота API-запроса

Определяет типы методов API-запросов "POST", "PUT" и "DELETE".

#### API-интерфейсы: `IApi`, `IOrderData` и `IPurchaseData`

##### `IApi`

Определяет наличие у реализующих и использующих в рамках композиции его сущностей, в частности, констуктора специализированного класса `larekAPI`, следующих API-методов:

- `get()` - типизированного метода запроса на получение данных, который принимает адрес `uri` и возвращает типизированный промис ответа
- `post()` - типизированного метода запроса на внесение изменений (`POST` | `PUT`) или удаление (`DELETE`) данных, который принимает адрес `uri`, объект передаваемых данных `data`, тип метода запроса `method`, а возвращает типизированный промис ответа

##### `ILarekProducts` - тип успешного ответа сервера на запрос списка товаров

`ILarekProducts` имеет следующие  свойства:

- `total` - количество товаров типа `number`;
- `items` - массив товаров типа `IProduct`.

##### `IOrderData` - тип данных, передаваемых в теле запроса при оформлении заказа (покупки)

`IOrderData` расширяет `IBuyer`, добавяя к его свойствам стоимость `total` товаров типа `Price` в корзине и массив их идентификаторов `items` типа `UUID`.

##### `IPurchaseData` - тип ответа сервера при успешном оформлении заказа (покупке), содержащий свойства:

- `id` - идентификатор зарегистрированного заказа типа `UUID`;
- `total` - стоимость покупки типа `Price`.

#### Базовые типы для работы со списками и заказом

##### `UUID` - тип, определяющий формат уникального ключа товара по стандарту Universally Unique Identifier

Тип `UUID` представляет шаблонный литеральный тип, состоящий из 5 строковых фрагментов, разделенных символом `-`.

##### `Price` - стоимость товара

Тип `Price` - `nunumber` для продуктов, имеющих цену, и `null` - для бесценных;

##### `TPayment` - способ оплаты

Способ оплаты может принимать значения `"online"`, `"cash"` или `undefined` (для случае, кодга способ не выбран).

#### Товар - `IProduct`

Описывает главную сущность - товар, обладающий следующими свойствами:

- `id` - уникальный идентификатор товара типа `UUID` (не должен изменяться);
- `description` - описание товара типа `string`;
- `image` - завершающий фрагмент пути к файлу картинки товара типа `string`;
- `title` - название товара типа `string`;
- `category` - категория товара (допускается только одна) типа `string`;
- `price` - цена типа `Price` (`null` для непродаваемых товаров).

#### Каталог товаров - `ICatalog`

`ICatalog` разработан для описания типа универсального переиспользуемого хранилища объектов типа `T`. Он определяет следующие методы и свойства:
`items: T[]` - массив хранимых объектов типа `T`;
`size: number` - количество объектов в каталоге;
`selectedItem: T | undefined` - объект, выбранный для подробного отображения, типа `T` (`undefined` - если не выбран);
`addItem(item: T)` - метод добавления в каталог объекта `item` типа `T`;
`addItems(items: T[]): void` - метод добавления в каталог массива `items` объектов типа `T`;
`getItemByKey(id: UUID): T | undefined` - метод вывода из каталога объекта типа `T` по его идентификатору `id` типа `UUID`;
`removeItemByKey(id: UUID): boolean` - метод удаления из каталога объекта по его ключу `id` типа `UUID` (`true`, если удаление успешно, и `false`, если нет);
`clear()` - метод очистки каталога (в процессе очистки сбрасывает `selectedItem` в `undefined`);
`hasItem(id: UUID): boolean` - метод проверки наличия объекта в каталоге по его ключу `id` типа `UUID`

#### Корзина товаров - `IBasket`

Учитывая, что корзина товаров - это хранилище объектов, имеющих цену, `IBasket` построен на generic-типе `T`, расширяющем объект, имеющий свойство `price` типа `Price`. С другой стороны, свойства и функционал корзины товаров аналогичен каталогу товаров, поэтому целессобразно `IBasket` сделать типом, расширяющим `ICatalog`. `IBasket` добавляет к `ICatalog` следующие свойства и методы:

- `total` - стоимость корзины типа `Price`;
- `order: Omit<IOrderData, keyof IBuyer>` - метод получения данных корзины, отправляемых в теле запроса на оформление заказа, возвращающий объект с данными, соответствующий `IOrderData` без свойств, описанных в `IBuyer`;
- `addItemByKey(id: UUID)` - метод добавления в корзину товара по его идентификатору `id` типа `UUID`;
- `delItem(id: UUID)` - метод удаления из корзины товара по его идентификатору `id` типа `UUID`;
- `getItemsIds()` - метод получение массива идентификаторов товаров типа `UUID` в корзине.

#### Покупатель - `IBuyer`

Описывает данные заказчика (покупателя): `payment: TPayment` - способ оплаты типа TPayment; `email` - email, `phone` - номер телефона, `address` - адрес (тип string); `data` - сводные данные покупателя в виде объекта, необхожимые для тела запроса на оформление заказа. Свойство `data` построено на базе утилитарного типа `Omit`, определяющего на основе `IBuyer` тип, имеющий все его типизированные свойства за исключением `data`.

### Модели данных (`Model`)

#### КАТАЛОГ ПРОДУКТОВ - `Catalog`

##### Назначение

Разработан для описания функционала универсального переиспользуемого хранилища объектов типа `T`, имеющих readonly-свойство `id` типа `UUID` - уникальный ключ для CRUD-операций с данными хранилища (каталога товаров).

##### Реализация

Реализует методы и свойства `ICatalog`, созданные для работы с объектами типа `T`, имеющими уникальный ключ `id` типа `UUID`.

##### Конструктор

Опционально принимает массив `items` объектов типа `T` (товаров, если `T` = `IProduct`) и сохраняет его в защищенном поле `_items` в виде Map-коллекции объектов типа `T` с ключом типа `UUID`. Если `items` не определен, то создается пустая Map-коллекции.

##### Поля

- `_items` - защищенное свойство, хранящее объекты (товары) каталога, в виде Map-коллекции объектов типа `T` с ключом типа `UUID`.

- `_selectedItem` - защищенное свойство, хранящее объект, выбранный из каталога (в т.ч. для подробного отображения).

##### Методы

- `addItem(item: T)` - добавление объекта типа `T` в каталог
- `addItems(items: T[])` - добавление массива объектов типа `T` в каталог
- `getItemByKey(id: UUID): T` - получение из каталога объекта типа `T` по его ключу `id` типа `UUID` (если не найден - возращает `undefined`)
- `clear()` - очистка каталога и сброс выбранного объекта в `undefined`
- `size(): number` - получение количества объектов в каталоге
- `removeItemByKey(id: UUID): boolean` - удаление объекта из каталога по его ключу `id` типа `UUID` (возвращает `boolean`: `true` - успешно, `false` - нет)
- `items(): T[]` - получение массива объектов типа `T`, хранимых в каталоге,
- `set items(items: T[])` - сохранение массива `items` объектов типа `T` (перед сохранением выполняется очистка каталога и сброс выбранного объекта в `undefined`)
- `hasItem(id: UUID): boolean` - проверка наличия объекта в каталоге по его ключу `id` типа `UUID` (возвращает `boolean`: `true` - найден, `false` - нет)
- `set selectedItem(id: UUID | undefined)` - сохранение выбранного объекта по его ключу `id` типа `UUID` (перед сохранением проверяется наличие в каталоге объекта с заданным ключом)
- `selectedItem(): T | undefined` - получение выбранного объекта типа `T` (если объект не определен, то возвращается `undefined`)

#### КОРЗИНА ПРОДУКТОВ - `Basket`

##### Назначение

Разработан для описания функционала работы с корзиной объектов (товаров) типа `T`, выбранных из каталога. Объекты должны иметь:

- readonly-свойство `id` типа `UUID` - уникальный ключ для CRUD-операций с данными корзины;
- свойство `price` типа `Price` - цену объекта

##### Реализация

Расширяет `Basket` и реализует `IBasket`.

##### Конструктор

Вызывает конструктор родительского (расширяемого) специализированного класса `Catalog` для создания и последующих операций с хранилищем отобранных в корзину объектов (товаров). Принимает и сохраняет в защищенное поле `_catalog` экземпляр `catalog` каталога товаров типа `ICatalog`, из которого в дальнейшем выбираются товары в корзину.

##### Поля

- защищенное поле `_catalog` - экземпляр каталога товаров типа `ICatalog`, из которого выбираются товары в корзину.

##### Методы

- `get total(): Price` - получение расчетной стоимости корзины типа `Price`. Для исключения потенциальных runtime-ошибок перед расчетом стоимости выполняется отсев объектов с null-ценой;
- `addItemByKey(id: UUID): void` - добавление объекта (товара) из каталога в в корзину по его ключу `id` типа `UUID`. Перед добавлением в корзину по заданному ключу `id` проверяется наличие объекта (товара) в каталоге `_catalog`. Добавляемый товар также должен иметь цену (значение свойства `price` не должно быть `null`).
- `delItem(id: UUID): void` - удаление из корзины объекта (товара) с указанным ключом `id` типа `UUID`. Перед удалением проверяется его наличие в корзине.
- `getItemsIds(): UUID[]` - получение массива ключей объектов (товаров) типа `UUID`, хранимых в корзине.
- `get order(): Omit<IOrderData, keyof IBuyer>` - получение данных корзины для оформления заказа. Для определения типа возвращаемого геттером `order` значения используется утилитарный тип `Omit`, который выбирает из `IOrderData` все свойства и их типы за исключением тех, что определены `IBuyer`:

#### ПОКУПАТЕЛЬ - `Buyer`

##### Назначение

Описывает работу с данными покупателя.

##### Реализация

Реализует `IBuyer`.

##### Конструктор

Конструктор опционально принимает объект `buyer` с данными покупателя. С помощью утилитарного типа `Partial` опционально могут определены все или часть свойств покупетля.

##### Поля

Все поля - защищенные и иниуиализированы

- `_payment` - способ оплатиы типа `TPayment` (по умолчанию - `undefined`)
- `_email` - электронная почта типа `string`
- `_phone` - телефон типа `string`
- `_address` - адрес типа `string`

##### Методы

- методы получения и определения свойств покупателя:

  - для каждого отдельного свойства покупателя определены геттеры и сеттеры, принимающие и возвращающие данные соответствующих типов;
  - `data(): Omit<IBuyer, 'data'>` - получение данных корзины для оформления заказа (покупки) - все полей `Buyer` в виде объекта (утилитарный класс `Omit`используется для исключения геттера `data` из `IBuyer`);

- `clear()` - очистка всех полей экземпляра `Buyer` путем сброса к их начальным значениям:
- `isEmailValid()`, `isPhoneValid()`, `isAddressValid()`, `isPaymentValid()` - метод проверки валидности каждого отдельного полей покупателя, возвращающие `true`, если значение валидное, и `false`, если нет (перед проверкой у всех строковых полей удаляются начальные и завершающие пробелы);
  - `isAllValid()` - методы проверки валидности одновременно всех полей покупателя, возвращаюий `true`, если все поля валидные, и `false`, если нет (валидация выполняется на основе методов проверки валидности каждого из полей `Buyer`).

### Коммуникационный слой

#### API WEBLAREK - `LarekAPI`

##### Назначение

Специализированный класс для работы с запросами API WEBLAREK (работа с товарами). Позволяет запросить данные для каталога товаров и оформить (зарегистрировать) заказ (покупку).

##### Реализация

Реализует композицию объектов типов `IApi`, `IBasket`, `IBuyer` и собственные методы на его основе.

##### Конструктор

Принимает объекты типов `IApi`, `IBasket`, `IBuyer` и сохраняет ссылки на них в защищенных полях `_api`, `_basket` и `_buyer`, соответственно:

##### Поля

- `_api` - ссылка на объект типа `IApi`, реализующий универсальные методы запроса данных.
- `_basket` - ссылка на объект типа `IBasket`, позволяющий получить данные о корзине товаров типа `IProduct`
- `_buyer` - ссылка на объект типа `IBuyer`, позволяющий получить данные о покупателе типа `IBuyer`

##### Методы

- `getShopProducts` - метод get-запроса массива товаров для отображения в каталоге (в случае успеха `getShopProducts` возврает промис данных типа `ILarekProducts`, в противном случае - данные об ошибке типа `Response`);
- `placeOrder` - метод post-запроса на оформление заказа (покупки), передающий в его теле объект типа `IOrderData` с данными о заказе (объект с данными о заказе формируется геттером `orderData`. В случае успеха данный метод возврает промис с данными о регистрации заказа (покупке) типа `IPurchaseData` или данными об ошибке типа `Response`).
- `orderData` - метод, формирующий на основе данных корзины (`_basket`) и покупателя (`_buyer`) объект данных типа `IOrderData`, отправляемый в теле post-запроса на оформление заказа (покупки).

### [UML-диаграама приложения](./src/public/app-uml.md)

UML-диаграама приложения находится в файле `./src/public/app-uml.md`.
