# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/main.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```sh
npm install
npm run dev
```

или

```sh
yarn
yarn dev
```

## Сборка

```sh
npm run build
```

или

```sh
yarn build
```

# Интернет-магазин «Web-Larёk»

«Web-Larёk» — это интернет-магазин с товарами для веб-разработчиков, где пользователи могут просматривать товары, добавлять их в корзину и оформлять заказы. Сайт предоставляет удобный интерфейс с модальными окнами для просмотра деталей товаров, управления корзиной и выбора способа оплаты, обеспечивая полный цикл покупки с отправкой заказов на сервер.

## Архитектура приложения

Код приложения разделен на слои согласно парадигме `MVP` (`Model-View-Presenter`), которая обеспечивает четкое разделение ответственности между классами слоев `Model` и `View`. Каждый слой несет свой смысл и ответственность:

`Model` - слой данных, отвечает за хранение и изменение данных.  
`View` - слой представления, отвечает за отображение данных на странице.  
`Presenter` - презентер содержит основную логику приложения и отвечает за связь представления и данных.

Взаимодействие между классами обеспечивается использованием событийно-ориентированного подхода. Модели и Представления генерируют события при изменении данных или взаимодействии пользователя с приложением, а Презентер обрабатывает эти события используя методы как Моделей, так и Представлений.

### Базовый код

#### Класс Component

Является базовым классом для всех компонентов интерфейса.
Класс является дженериком и принимает в переменной `T` тип данных, которые могут быть переданы в метод `render` для отображения.

Конструктор:  
`constructor(container: HTMLElement)` - принимает ссылку на DOM элемент за отображение, которого он отвечает.

Поля класса:  
`container: HTMLElement` - поле для хранения корневого DOM элемента компонента.

Методы класса:  
`render(data?: Partial<T>): HTMLElement` - Главный метод класса. Он принимает данные, которые необходимо отобразить в интерфейсе, записывает эти данные в поля класса и возвращает ссылку на DOM-элемент. Предполагается, что в классах, которые будут наследоваться от `Component` будут реализованы сеттеры для полей с данными, которые будут вызываться в момент вызова `render` и записывать данные в необходимые DOM элементы.  
`setImage(element: HTMLImageElement, src: string, alt?: string): void` - утилитарный метод для модификации DOM-элементов `<img>`

#### Класс Api

Содержит в себе базовую логику отправки запросов.

Конструктор:  
`constructor(baseUrl: string, options: RequestInit = {})` - В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.

Поля класса:  
`baseUrl: string` - базовый адрес сервера  
`options: RequestInit` - объект с заголовками, которые будут использованы для запросов.

Методы:  
`get(uri: string): Promise<object>` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер  
`post(uri: string, data: object, method: ApiPostMethods = 'POST'): Promise<object>` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.  
`handleResponse(response: Response): Promise<object>` - защищенный метод проверяющий ответ сервера на корректность и возвращающий объект с данными полученный от сервера или отклоненный промис, в случае некорректных данных.

#### Класс EventEmitter

Брокер событий реализует паттерн "Наблюдатель", позволяющий отправлять события и подписываться на события, происходящие в системе. Класс используется для связи слоя данных и представления.

Конструктор класса не принимает параметров.

Поля класса:  
`_events: Map<string | RegExp, Set<Function>>)` - хранит коллекцию подписок на события. Ключи коллекции - названия событий или регулярное выражение, значения - коллекция функций обработчиков, которые будут вызваны при срабатывании события.

Методы класса:  
`on<T extends object>(event: EventName, callback: (data: T) => void): void` - подписка на событие, принимает название события и функцию обработчик.  
`emit<T extends object>(event: string, data?: T): void` - инициализация события. При вызове события в метод передается название события и объект с данными, который будет использован как аргумент для вызова обработчика.  
`trigger<T extends object>(event: string, context?: Partial<T>): (data: T) => void` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие с передачей в него данных из второго параметра.

### Данные

#### `ApiPostMethods` - тип медота API-запроса

Определяет типы методов API-запросов "POST", "PUT" и "DELETE".

#### API-интерфейсы: `IApi`, `IOrderData` и `IPurchaseData`

##### `IApi`

Определяет наличие у реализующих и использующих в рамках композиции его сущностей, в частности, констуктора специализированного класса `larekAPI`, следующих API-методов:

- `get()` - типизированного метода запроса на получение данных, который принимает адрес `uri` и возвращает типизированный промис ответа
- `post()` - типизированного метода запроса на внесение изменений (`POST` | `PUT`) или удаление (`DELETE`) данных, который принимает адрес `uri`, объект передаваемых данных `data`, тип метода запроса `method`, а возвращает типизированный промис ответа

##### `ILarekProducts` - тип успешного ответа сервера на запрос каталога товаров

`ILarekProducts` имеет следующие свойства:

- `total` - количество товаров типа `number`;
- `items` - массив товаров типа `IProduct`.

##### `IOrderData` - тип данных, передаваемых в теле запроса при оформлении заказа (покупки)

`IOrderData` расширяет `IBuyer`, добавяя к его свойствам стоимость `total` товаров типа `Price` в корзине и массив их идентификаторов `items`.

##### `IPurchaseData` - тип ответа сервера при успешном оформлении заказа (покупке), содержащий свойства

- `id` - идентификатор зарегистрированного заказа;
- `total` - стоимость покупки типа `Price`.

#### Базовые типы для работы со списками и заказом

##### Стоимость товара - `Price`

Тип `Price` - `number` для продуктов, имеющих цену, и `null` - для бесценных;

##### Способ оплаты - `TPayment`

Способ оплаты может принимать значения `"online"`, `"cash"` или `undefined` (для случае, кодга способ не выбран).

#### Товар - `IProduct`

Описывает главную сущность - товар, обладающий следующими свойствами:

- `id` - уникальный идентификатор товара (не должен изменяться);
- `description` - описание товара типа `string`;
- `image` - завершающий фрагмент пути к файлу картинки товара типа `string`;
- `title` - название товара типа `string`;
- `category` - категория товара (допускается только одна) типа `string`;
- `price` - цена типа `Price` (`null` для непродаваемых товаров).

#### Каталог товаров - `ICatalog`

Определяет следующие методы и свойства:
`items: IProduct[]` - массив хранимых товаров типа `IProduct`;
`selectedItem: IProduct | undefined` - товар, выбранный для подробного отображения, типа `IProduct` (`undefined` - если не выбран);
`addItems(items: IProduct[]): void` - метод добавления в каталог массива `items` товаров типа `T`;
`getItemById(id: string): IProduct | undefined` - метод вывода из каталога товара по его идентификатору `id`;

#### Корзина товаров - `IBasket`

Корзина товаров - это хранилище товаров, свойства и функционал которого аналогичен каталогу товаров, целессобразно `IBasket` сделать типом, расширяющим `ICatalog`. `IBasket` добавляет к `ICatalog` следующие свойства и методы:

- `items` - массив товаров типа `IProduct` в корзине
- `itemCount` - количество товаров в корзине типа `number`
- `total` - стоимость корзины типа `Price`;
- `addItem(item: IProduct)` - метод добавления в корзину товара типа `IProduct`;
- `delItemById(id: string)` - метод удаления из корзины товара по его идентификатору `id`;

#### Покупатель - `IBuyer`

Описывает данные заказчика (покупателя): `payment: TPayment` - способ оплаты типа TPayment; `email` - email, `phone` - номер телефона, `address` - адрес (тип string).

### Модели данных (`Model`)

#### КАТАЛОГ ПРОДУКТОВ - `Catalog`

##### Назначение

Разработан для описания функционала хранилища товаров.

##### Реализация

Реализует методы и свойства `ICatalog`, созданные для работы с товарами типа `IProduct`, имеющими уникальный идентификатор `id`. Товары хранятся в массиве типа `IProduct[]`.

##### Конструктор

Опционально позволяет инициализировать каталог товаров массивом `items` типа `IProduct[]` и сохраняет его в защищенном поле `_items`. При совпадении идентификаторов новых и ранее добавленных товаров последние будут перезаписаны. Если `items` не определен, то создается пустой каталог.

##### Поля

- `_items` - защищенное свойство, хранящее товары каталога в виде масива типа `IProduct[]`.

- `_selectedItem` - защищенное свойство, хранящее товар типа `IProduct`, выбранный из каталога (в т.ч. для подробного отображения). По умолчанию не определен.

##### Методы

- `addItems(items: IProduct[])` - добавление в каталог массива товаров типа `IProduct`
- `setSelectedItem(id: string | undefined)` - Задание выбранного товара по его `id`
- `getItemById(id: string)` - получение из каталога товаров типа `IProduct` по его идентификатору `id` (если не найден - возращает `undefined`)
- `items(): IProduct[]` - получение массива товаров типа `IProduct`, хранимых в каталоге
- `items(items: IProduct[])` - сохранение (перезапись) массива `items` товаров типа `IProduct` (перед сохранением выбранный товар сбрасывается в `undefined`)
- `selectedItem(item: IProduct | undefined)` - сохранение выбранного товара `item`
- `selectedItem(): IProduct | undefined` - получение выбранного тивара типа `IProduct` (если товар не определен, то возвращается `undefined`)

#### КОРЗИНА ПРОДУКТОВ - `Basket`

##### Назначение

Разработан для описания функционала работы с корзиной товаров типа `IProduct`, выбранных из каталога.

##### Реализация

Реализует `IBasket`.

##### Поля

- `_items` - защищенное свойство, хранящее товары корзины в виде массива типа `IProduct[]`.

##### Методы

- `items(): IProduct[]` - получение массива товаров типа `IProduct`, хранимых в корзине
- `items(items: IProduct[])` - сохранение массива `items` товаров типа `IProduct` в корзину (перед сохранением выполняется ее очистка)
- `total(): Price` - получение расчетной стоимости корзины типа `Price`. Для исключения потенциальных runtime-ошибок перед расчетом стоимости выполняется отсев объектов с null-ценой
- `addItem(item?: IProduct)` - добавление товара `item` типа `IProduct` в корзину. Добавляемый товар должен иметь цену (значение свойства `price` не должно быть `null`).
  Если товар с `id` уже есть в корзине, то он перезаписывается.
- `delItemById(id: string)` - удаление из корзины товара с указанным идентификатором `id`. Перед удалением проверяется его наличие в корзине.
- `hasItem(id: string)` - проверка наличия в корзине товара с идентификатором `id` типа `string`
- `clear()` - очистка корзины
- `itemCount()` - получение количества товаров в корзине

#### ПОКУПАТЕЛЬ - `Buyer`

##### Назначение

Описывает работу с данными покупателя.

##### Конструктор

Конструктор опционально принимает объект `buyer` с данными покупателя. С помощью утилитарного типа `Partial` опционально могут определены все или часть свойств покупателя.

##### Поля

Все поля - защищенные и инициализированы (поля строкового типа - пустой строкой, типа `TPayment` - `undefined`):

- `payment` - способ оплатиы типа `TPayment` (по умолчанию - `undefined`)
- `email` - электронная почта типа `string`
- `phone` - телефон типа `string`
- `address` - адрес типа `string`

##### Методы

- `set<K extends keyof IBuyer>(field: K, value: IBuyer[K])` - универсальный метод, принимающий имя и значение свойства покупателя, соответствующее интерфейсу `IBuyer` и задающий его соответствующему защищенному свойству;
- `clear()` - очистка всех полей экземпляра `Buyer` путем сброса к их начальным значениям;
- `get errors()` - геттер, возвращающий ошибки валидации данных покупателя (объект со свойствами, хранящими сообщения об ошибках). Если ошибок нет, возвращает пустой объект.
-
- `get valid()` - геттер, возвращающий булевую оценку валидности всех данных покупателя.

### Коммуникационный слой

#### API WEBLAREK - `LarekAPI`

##### Назначение

Обеспечивает работу с запросами API WEBLAREK. Позволяет запросить данные для каталога товаров и оформить заказ.

##### Реализация

Реализует композицию объекта типа `IApi` и собственные методы на его основе.

##### Конструктор

Принимает объект типа `IApi` и сохраняет его в защищенном поле `_api`.

##### Поля

- `_api` - ссылка на объект типа `IApi`, реализующий универсальные методы запроса данных.

##### Методы

- `getShopProducts` - метод get-запроса массива товаров для отображения в каталоге (в случае успеха `getShopProducts` возврает промис данных типа `ILarekProducts`, в противном случае - данные об ошибке типа `Response`);
- `placeOrder(orderData: IOrderData)` - метод post-запроса на оформление заказа (покупки), принимающий `orderData` - сводные данные типа `IOrderData` о заказе (данные покупателя и его корзины). В случае успеха данный метод возврает промис с данными о регистрации заказа (покупке) типа `IPurchaseData` или данными об ошибке типа `Response`.

### Слой представления (View)

#### АБСТРАКТНАЯ КАРТОЧКА ТОВАРА - `Card`

##### Назначение

Базовый класс для создания специализированных карточек галереи, корзины и подробного просмотра товаров.

##### Реализация

Реализован в форме абстрактного класса, расширяет класс `Component` и соответствует интерфейсу `ICard`.

##### Конструктор

Принимает контейнер карточки и экземпляр брокера событий. Определяет элементы размеки, отвечающие за заголовок и цену товара карточки. Добавляет обработчики событий открытия окна подробного просмотра карточки и удаления товара из корзины с помощью кнопки.

##### Поля

- `titleEl` - HTMLElement названия товара
- `priceEl` - HTMLElement вывода цены товара

##### Методы

- `title(text: string)` - сеттер, задающий в карточке название товара 
- `price(value: Price)` - сеттер, задающий в карточке цену товара (если цена не указана, то выводится "Бесценно")
- `render(data?: Partial<T>): HTMLElement` - public-метод, отвечающий за создание HTML-разметки карточки. Опционально примает данные типа, с которым работает класс карточки, и возвращает HTML-разметку карточки с обновленными данными или ее контейнер.
  
#### КАРТОЧКА ГАЛЕРЕИ - `GalleryCard`

##### Назначение

Создание карточек галереи.

##### Реализация

Расширяет класс `Card` абстрактной карточки товара, реализует интерфейс `IGalleryCard`.

##### Конструктор

Принимает контейнер карточки и экземпляр брокера событий. Определяет элементы размеки, отвечающие за категорию и изображение товара карточки.

##### Поля

- `categoryEl` - HTMLElement категории товара
- `imageEl` - HTMLElement изображения товара

##### Методы

- `category(key: string)` - сеттер, задающий в карточке категорию товара и ее стиль отображения
- `image(path: string)` - сеттер, задающий в карточке изображение товара

#### КАРТОЧКА КОРЗИНЫ - `BasketCard`

##### Назначение

Создание карточек корзины.

##### Реализация

Расширяет класс `Card` абстрактной карточки товара, реализует интерфейс `IBasketCard`.

##### Конструктор

Принимает контейнер карточки и экземпляр брокера событий. Определяет элемент размеки, отвечающиq за порядковый номер карточки товара в корзине.

##### Поля

- `IndexEl` - HTMLElement порядкового номера товара в корзине

##### Методы

- `render(data?: IBasketCardData, index?: number): HTMLElement` - public-метод, отвечающий за создание HTML-разметки карточки корзины. Опционально примает данные типа `IBasketCardData`, и возвращает HTML-разметку карточки корзины с обновленными данными или ее контейнер.

#### АБСТРАКТНАЯ ФОРМА - `Form`

##### Назначение

Базовый класс для создания специализированных форм ввода данных заказа, необходимых при его оформлении.

##### Реализация

Реализован в форме абстрактного класса, расширяет класс `Component` и соответствует интерфейсу `IForm`.

##### Конструктор

Принимает контейнер формы и экземпляр брокера событий. Определяет элементы размеки, отвечающие за кнопку отправки формы, вывод ошибки ее валидации и список полей ввода данных. Добавляет обработчик события отправки формы.

##### Поля

- `form` - форма
- `submitBtn` - кнопка отправки формы
- `errorsEl` - HTMLElement вывода ошибки валидации формы
- `inputsList` - список полей ввода данных формы

##### Методы

- `errors(text: string)` - сеттер, задающий ошибку валидации формы
- `reset()` - public-метод, очищающий поля ввода данных
- `disableSubmitButton(disabled: boolean)` - сеттер, определяющий доступность кнопки отправки формы

#### ПЕРВАЯ ФОРМА ЗАКАЗА - `OrderForm`

##### Назначение

Создания первой формы заказа.

##### Реализация

Расширяет абстрактный класс форм `Form`, специализированный под интерфейс `IOrderForm`.

##### Конструктор

Принимает контейнер формы и экземпляр брокера событий. Определяет элементы размеки, отвечающие за адрес доставки, способ оплаты и отправку формы. Добавляет обработчик события выбора способа оплаты и изменения в поле ввода адреса доставки.

##### Поля

- `paymentBtns` - массив (группа) кнопок выбора способа оплаты
- `selectedPaymentBtn` - выбранная кнопка способа оплаты
- `addressInp` - HTMLInputElement адреса доставки

##### Методы

- `selectedPayment(button: HTMLButtonElement | undefined)`  - сеттер, задающий способ оплаты заказа
- `handlePaymentButtonClick` - обработчик события выбора способа оплаты, определяющий через сеттер выбранный способ и стиль отображения группы соответствующих кнопок
- `reset()` - public-метод, очищающий поля ввода данных и сбрасывающий выбранный способа оплаты





#### ВТОРАЯ ФОРМА ЗАКАЗА - `ContactsForm`

##### Назначение

Создания второй формы заказа.

##### Реализация

Расширяет абстрактный класс форм `Form`, специализированный под интерфейс `IContactsForm`.

##### Конструктор

Принимает контейнер формы и экземпляр брокера событий. Определяет элементы размеки, отвечающие за email и телефон покупателя. Добавляет обработчик события изменения в полях ввода данных.

##### Поля

- `emailInp` - HTMLInputElement ввода email покупателя
- `phoneInp` - HTMLInputElement ввода телефона покупателя









  ### UML-диаграама приложения

- [JPG](./src/public/app-uml.jpg)
- [mermaid](./src/public/app-uml.md)